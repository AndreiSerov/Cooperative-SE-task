# План выполнения первого набора требований

#### 0. Подготовительные шаги
1. Включить toggl
2. Прочитать требования
3. Создать репозиторий
4. Создать пустой проект в Idea

#### 1. Описать тестовые данные
1. Описать пользователей  
 
 № | login | pass 
 --- | --- | ---  
 U1 | vasya | 123  
 U2 | admin | admin  
 U3 | q | ?!#  
 U4 | abcdefghij | pass

2. Описать ресурсы  
 
 № | res | role | user
 --- | --- | --- | ---
 R1 | A | READ | vasya
 R2 | A.B.C | WRITE | vasya
 R3 | A.B | EXECUTE | admin
 R4 | A | READ | admin
 R5 | A.B | WRITE | admin
 R6 | A.B.C | READ | admin
 R7 | B | EXECUTE | q
 
#### 2. Создать скрипты
 1. Записать тесты в bat/sh файл
 
 № | Входные данные | Ожидаемый результат
  --- | --- | ---
 T1.1 | app.jar | 1 + справка
 T1.2 | app.jar -h | 1 + справка
 T1.3 | app.jar -q | 0 + справка
 Т1.4 | app.jar 12345 | 0 + справка
 T1.5 | app.jar -res A.B 12345 | 0 + справка
 T2.1 | app.jar -login vasya -pass 123 | 0
 T2.2 | app.jar -login VASYA -pass 123 | 2
 T2.3 | app.jar -login asd -pass 123 | 3
 T2.4 | app.jar -login admin -pass 123 | 4
 T3.1 | app.jar -login vasya -pass 123 -res A -role READ | 0
 T3.2 | app.jar -login vasya -pass 123 -res A -role DELETE | 5
 T3.3 | app.jar -login vasya -pass 123 -res A -role WRITE | 6
 T3.4 | app.jar -login vasya -pass 123 -res A.B -role READ | 0
 T3.5 | app.jar -login vasya -pass 0000 -res A.B -role DELETE | 4
 T3.6 | app.jar -login admin -pass admin -res A -role EXECUTE | 6
 T3.7 | app.jar -login admin -pass admin -res A.A -role WRITE | 6
 T4.1 | app.jar -login vasya -pass 123 -res A -role READ -ds 2020-03-10 -de 2020-03-11 -vol 100 | 0
 T4.2 | app.jar -login vasya -pass 123 -res A -role READ -ds 2020.03.10 -de 2020.03.11 -vol 100 | 7
 T4.3 | app.jar -login vasya -pass 123 -res A -role READ -ds 2020-03-10 -de 2020-03-11 -vol aaaa | 7
 T4.4 | app.jar -login vasya -pass 123 -res A -role EXECUTE -ds 01.02.3012 -de 01.02.2030 -vol aaa | 6
 T4.5 | app.jar -login vasya -pass 123 -res A -role READ -ds 2020-03-11 -de 2020-03-10 -vol 100 | 7
 
 2. Создать скрипт компиляции (**R1.12**)
 3. Создать скрипты запуска (**R1.12**)
 
 
 #### 3. Простейшие сценарии
 1. Проверяем наличие аргументов (**R1.8**)
 2. Создаем функцию вывода справки
 3. Проверяем, надо ли выводить справку 
    + Если пусто возвращаем 1
    + Если `args[0]=="-h"` возвращаем 1
    + Если неизвестные аргументы возвращаем 0
    + Если неправильное число аргументов возвращаем 0
 
 #### 4. Аутентификация 
 1. Создаем метод надо ли аутентифицировать 
(`args[0]=="-login" && args[2]=="-pass"`) (**R1.1**)
 2. Создаем метод проверки правильности формата логина (**R1.1**)
 3. Создаем метод проверки существования логина
     + `login==vasya`
 4. Создаем метод проверки пароля
     + `pass==123`
 5. Создаем `data class User`
     + `login`
     + `pass`
 6. Создаем коллекцию юзеров с тестовыми данными
 7. Исправляем методы 4.3 и 4.4 на работу с коллекцией юзеров
 8. Создаем класс `ArgHandler` 
    + `h`
    + `login`
    + `pass`
    + конструктор (`args:Array<String>` )
    + нужна ли справка
    + есть ли аргументы
    + нужна ли аутентификация
 9. Рефакторинг кода, чтобы использовался `ArgHandler`
 10. Дополняем справку
 
 #### 5. Авторизация
 1. В `ArgHandler` создать метод нужна ли авторизация (**R1.11**)
    + Проверяем наличие обязательных параметров (ресурса и роли)
	+ Если не нужна авторизация, то заканчиваем программу с кодом 0  
	Иначе запускаем авторизацию
 3. Создаем `data class Resource`
    + `res`
    + `role`
    + `user`
 4. Создать коллекцию ресурсов с тестовыми данными 
 5. Создаем список допустимых ролей
 6. Создать метод проверки существования роли (**R1.5**)
 7. Добавляем поля `res` и `role` в `ArgHandler`
 8. Добавляем методы проверки формата ресурса (**R1.3**)
    + Если неверный формат ресурса, заканчиваем выполнение программы с кодом 6 
      Иначе продолжаем выполнение программы
 9. Добавляем метод поиска ресурса по имени в класс Ресурс (**R1.3**)
 10. Создать метод проверки доступа (есть ли у пользователя права на выбранную им роль) (**R1.3**)
	+ `user==vasya res==A role==READ`
 11. Переделать метод 5.10 на работу с коллекцией
 12. Добавляем метод проверки вложенности ресурса (используем   
 `substring(0,res.length)`) (**R1.6, R1.4**)
	+ (Если ресурс из таблицы является началом требуемого  
	ресурса, предоставить доступ)
 13. Создать метод авторизации 
 14. В метод авторизации добавить вызов метода 5.7, а из него 5.8
 15. В метод поиска ресурса добавить флаг `доступ получен` (**R1.6**)
 16. Дополняем справку
 
#### 6. Аккаунтинг
 0. Добавляем поля `ds`, `de`, `vol` в `ArgHandler` 
 1. Создаем метод нужен ли аккаунтинг (**R1.11**)
 2. Создать класс `Session`
    + `user`
    + `role`
    + `res`
    + `ds`
	+ `de`
    + `vol`
 3. Создать метод обработки параметров `-ds -de -vol`(**R1.7**)
 4. Создать метод проверки формата `ds` и `de`
    + Если формат неверен, то возвращаем код 7 (**R1.9**)
      Иначе продолжаем выполнение программы
 5. Записываем данные в экземпляр класса `Session`
 6. Добавляем этот объект в коллекцию
 7. Дополняем справку


 #### 7. Добавляем фичи приложению
 1. Подключаем библиотеку kotlinx.cli для обработки параметров (**R1.10**)
	параметров командной строки в любом порядке
 2. Создать класс для безопасного хранения соли и перца (**R1.2**)
    + Хешируем пароль семейством SHA
    + Создаем соль, которая будет храниться в базе
    + Перец храним внутри класса